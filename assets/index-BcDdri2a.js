var U=Object.defineProperty;var G=(s,e,t)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>(G(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const a of h)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(h){const a={};return h.integrity&&(a.integrity=h.integrity),h.referrerPolicy&&(a.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?a.credentials="include":h.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(h){if(h.ep)return;h.ep=!0;const a=t(h);fetch(h.href,a)}})();class R{constructor(e,t,i){this.type=e,this.timeStamp=t,this.source=i}}class F extends R{constructor(e,t,i,h,a){super(e,t,a),this.x=i,this.y=h}}class $ extends R{constructor(e,t,i=null,h){super(e,t,h),this.key=i}}class j extends R{constructor(e,t,i,h,a){super(e,t,a),this.width=i,this.height=h}}let W;function P(s,e){W||(W=document.createElement("canvas"));const t=W.getContext("2d");if(!t)return null;t.font=e;const i=t.measureText(s);if(!i)return null;const h=i.fontBoundingBoxAscent+i.fontBoundingBoxDescent;return{width:i.width,height:h}}function A(s,e,t,i){return Math.sqrt((s-t)**2+(e-i)**2)}function J(s,e,t,i,h,a){return s>=t&&s<=t+h&&e>=i&&e<=i+a}const Z={update(s){switch(s.type){case"mousedown":case"mouseup":case"mousemove":return new F(s.type,s.timeStamp,s.x||0,s.y||0);case"keydown":case"keyup":return new $(s.type,s.timeStamp,s.key);case"resize":return new j(s.type,s.timeStamp,document.body.clientWidth,document.body.clientHeight);case"null":return;default:return new R(s.type,s.timeStamp)}}},Y={state:"IDLE",movementThreshold:10,timeThreshold:800,startX:0,startY:0,startTime:0,update(s){switch(this.state){case"IDLE":s.type=="mousedown"&&(this.state="DOWN",this.startX=s.x||0,this.startY=s.y||0,this.startTime=s.timeStamp);break;case"DOWN":if(s.timeStamp-this.startTime>this.timeThreshold)this.state="IDLE";else if(s.x&&s.y&&A(s.x,s.y,this.startX,this.startY)>this.movementThreshold)this.state="IDLE";else if(s.type=="mouseup")return this.state="IDLE",new F("click",s.timeStamp,s.x||0,s.y||0);break}}},Q={internalClickTranslator:{...Y},state:"IDLE",timeThreshold:500,startTime:0,update(s){const e=this.internalClickTranslator.update(s);switch(this.state){case"IDLE":e&&e.type=="click"&&(this.state="READY",this.startTime=e.timeStamp);break;case"READY":if(s.timeStamp-this.startTime>this.timeThreshold)this.state="IDLE";else if(e&&e.type=="click")return this.state="IDLE",new F("dblclick",s.timeStamp,s.x||0,s.y||0);break}}},tt={state:"IDLE",movementThreshold:20,startX:0,startY:0,update(s){switch(this.state){case"IDLE":s.type=="mousedown"&&(this.state="DOWN",this.startX=s.x||0,this.startY=s.y||0);break;case"DOWN":if(s.type=="mouseup")this.state="IDLE";else if(s.type=="mousemove"&&s.x&&s.y&&A(s.x,s.y,this.startX,this.startY)>this.movementThreshold)return this.state="DRAG",{type:"dragstart",timeStamp:s.timeStamp,x:s.x,y:s.y};break;case"DRAG":if(s.type=="mousemove")return{type:"drag",timeStamp:s.timeStamp,x:s.x,y:s.y};if(s.type=="mouseup")return this.state="IDLE",{type:"dragend",timeStamp:s.timeStamp,x:s.x,y:s.y};break}}};function K(s){if(s.type=="resize")return{type:s.type,timeStamp:s.timeStamp,width:document.body.clientWidth,height:document.body.clientHeight};if(s.type=="mouseup"||s.type=="mousedown"||s.type=="mousemove"){const e=s;return{type:s.type,timeStamp:s.timeStamp,x:e.x,y:e.y}}else if(s.type=="keyup"||s.type=="keydown"){const e=s;return e.repeat?void 0:{type:s.type,timeStamp:s.timeStamp,key:e.key}}else{console.warn(`event ${s.type} not supported as FundamentalEvent`);return}}function et(s){const e=[];function t(a){const d=K(a);d&&e.push(d)}window.addEventListener("mousedown",t),window.addEventListener("mouseup",t),window.addEventListener("mousemove",t),window.addEventListener("keydown",t),window.addEventListener("keyup",t),window.addEventListener("resize",t);const i=K(new Event("resize"));i&&e.push(i);function h(a){s(e,a),window.requestAnimationFrame(h)}window.requestAnimationFrame(h)}function it(s,e=["mousemove","resize"]){const t=[...s];s.length=0,t.forEach(i=>{if(i.type in e){const h=s.findIndex(a=>a.type in e);h>-1?s[h]=i:s.push(i)}else s.push(i)})}const o={font:"12pt sans-serif",textPadding:5,widgetHeight:32,defaultColour:"lightgrey",highlightColour:"lightskyblue",focusColour:"mediumblue",minElementSize:32};class D{constructor({x:e=0,y:t=0,width:i=void 0,height:h=void 0,fill:a="",border:d=""}={}){this.x=0,this.y=0,this._recalculateBasis=!1,this.widthBasis=0,this.heightBasis=0,this.fillWidth=0,this.fillHeight=0,this.recalculateLayout=!1,this.widthLayout=0,this.heightLayout=0,this._margin=0,this._padding=0,this.bindingTable=[],this.id="",this.debug=!1,this.x=e,this.y=t,this.width=i,this.height=h,this.fill=a,this.border=d}set width(e){e!==this._width&&(this._width=e,this.recalculateBasis())}get width(){return this._width}set height(e){e!==this._height&&(this._height=e,this.recalculateBasis())}get height(){return this._height}recalculateBasis(){this._recalculateBasis=!0,L()}calculateBasis(){if(this._recalculateBasis,this._recalculateBasis){const e=Math.max(this.width||0,2*this.padding);this.widthBasis=e+2*this.margin;const t=Math.max(this.height||0,2*this.padding);this.heightBasis=t+2*this.margin,this._recalculateBasis=!1,this.recalculateLayout=!0}return[this.widthBasis,this.heightBasis]}doLayout(e,t){if(this.recalculateLayout||e||t){const[i,h]=this.calculateBasis();this.widthLayout=e||i,this.heightLayout=t||h,this.recalculateLayout=!1}return{width:this.widthLayout,height:this.heightLayout}}set margin(e){e!==this.margin&&(e=Math.max(0,e),this._margin=e,this.recalculateBasis())}get margin(){return this._margin}get marginBox(){return{width:this.widthLayout,height:this.heightLayout}}set padding(e){e!==this.padding&&(e=Math.max(0,e),this._padding=e,this.recalculateBasis())}get padding(){return this._padding}get paddingBox(){return{width:this.widthLayout-2*this.margin,height:this.heightLayout-2*this.margin}}get contentBox(){return{width:this.widthLayout-2*this.margin-2*this.padding,height:this.heightLayout-2*this.margin-2*this.padding}}drawBoxModel(e){e.save(),e.lineWidth=1,this.margin>0&&(e.strokeStyle="red",e.setLineDash([2,2]),e.strokeRect(0,0,this.widthLayout,this.heightLayout)),this.padding>0&&(e.strokeStyle="green",e.setLineDash([2,2]),e.strokeRect(this.margin,this.margin,this.paddingBox.width,this.paddingBox.height)),e.strokeStyle="blue",e.setLineDash([2,2]),e.strokeRect(this.margin+this.padding,this.margin+this.padding,this.contentBox.width,this.contentBox.height),e.restore()}sendEvent(e,t=!1){let i=!1;return this.bindingTable.forEach(h=>{h.type==e.type&&h.capture==t&&(i||(i=h.handler(e)))}),i}addEventListener(e,t,i=!1){this.bindingTable.push({type:e,handler:t,capture:i})}removeEventListener(e,t,i=!1){this.bindingTable=this.bindingTable.filter(h=>!(h.type==e&&h.handler==t&&h.capture==i))}handleKeyboardEvent(e){return!1}handleMouseEvent(e){return!1}handleMouseEventCapture(e){return!1}hitTest(e,t){return J(e,t,this.x+this.margin,this.y+this.margin,this.paddingBox.width,this.paddingBox.height)}draw(e){this.debug&&(e.save(),e.translate(this.x,this.y),this.drawBoxModel(e),e.strokeStyle="white",e.lineWidth=2,e.textBaseline="top",e.textAlign="left",e.font="7pt sans-serif",e.strokeText(this.id,2,2),e.fillStyle="black",e.fillText(this.id,2,2),e.restore())}boxModelToString(){return`width:${this._width} height:${this._height} margin:${this.margin} padding:${this.padding} basis:${this.widthBasis}x${this.heightBasis} layout:${this.widthLayout}x${this.heightLayout}`}toString(){return`SKElement id:${this.id}`}}class f extends D{constructor(e={}){super(e),this._children=[],this.calculateBasis(),this.doLayout()}get children(){return this._children}addChild(e){this._children.push(e),L()}removeChild(e){this._children=this._children.filter(t=>t!=e),L()}clearChildren(){this._children=[],L()}handleMouseEventCapture(e){switch(e.type){case"click":return this.sendEvent({source:this,timeStamp:e.timeStamp,type:"action"},!0)}return!1}handleMouseEvent(e){switch(e.type){case"click":return this.sendEvent({source:this,timeStamp:e.timeStamp,type:"action"})}return!1}draw(e){e.save(),e.translate(this.x,this.y),e.translate(this.margin,this.margin),this.fill&&(e.fillStyle=this.fill,e.fillRect(0,0,this.paddingBox.width,this.paddingBox.height)),this.border&&(e.strokeStyle=this.border,e.lineWidth=1,e.strokeRect(0,0,this.paddingBox.width,this.paddingBox.height)),e.restore(),super.draw(e),e.save(),e.translate(this.x,this.y),e.translate(this.margin,this.margin),e.translate(this.padding,this.padding),this._children.forEach(t=>t.draw(e)),e.restore()}set layoutMethod(e){this._layoutMethod=e}doLayout(e,t){let i=this._recalculateBasis,h=super.doLayout(e,t);return this._recalculateBasis=i,this._children.length>0?(this._children.forEach(a=>a.calculateBasis()),this._children.forEach(a=>a.doLayout()),this._layoutMethod&&(h=this._layoutMethod(this.contentBox.width,this.contentBox.height,this._children),this._children.forEach(a=>a.doLayout())),h):{width:this.widthLayout,height:this.heightLayout}}toString(){return`SKContainer '${this.fill}'`+(this.id?` id '${this.id}' `:" ")+this.boxModelToString()}}let x=null;function st(s){x!=s&&(x&&x.handleKeyboardEvent({type:"focusout",timeStamp:performance.now(),key:null}),s.handleKeyboardEvent({type:"focusin",timeStamp:performance.now(),key:null}),x=s)}function ht(s){x==null||x.handleKeyboardEvent(s)}function q(s,e,t){const i=[];return"children"in t&&t.children.forEach(h=>i.push(...q(s-t.x-t.padding-t.margin,e-t.y-t.padding-t.margin,h))),t.hitTest(s,e)?[t,...i]:i}function at(s,e){if(E){E.handleMouseEvent(s),s.type=="mouseup"&&(E=null);return}const t=q(s.x,s.y,e);if(s.type=="mousemove"){const h=t.slice(-1)[0];nt(s,h)}t.some(h=>h.handleMouseEventCapture(s))||t.reverse().some(h=>h.handleMouseEvent(s))}let T;function nt(s,e){e!=T&&(T&&T.handleMouseEvent({...s,type:"mouseexit"}),e&&e.handleMouseEvent({...s,type:"mouseenter"}),T=e)}let E=null;function ot(s){E!=s&&(E=s)}class dt extends D{constructor({text:e="",...t}={}){super(t),this.font=o.font,this.state="idle",this._text="",this.padding=o.textPadding,this.text=e,this.calculateBasis(),this.doLayout()}get text(){return this._text}set text(e){this._text=e,this.setMinimalSize(this.width,this.height)}setMinimalSize(e,t){e=e||this.width,t=t||this.height;const i=P(this.text,this.font);if(!i){console.warn(`measureText failed in SKButton for ${this.text}`);return}this.height=t||i.height+this.padding*2,this.width=e||i.width+this.padding*2,e||(this.width=Math.max(this.width,80))}handleMouseEvent(e){switch(e.type){case"mousedown":return this.state="down",ot(this),!0;case"mouseup":return this.state="hover",this.sendEvent({source:this,timeStamp:e.timeStamp,type:"action"});case"mouseenter":return this.state="hover",!0;case"mouseexit":return this.state="idle",!0}return!1}draw(e){e.save();const t=this.paddingBox.width,i=this.paddingBox.height;e.translate(this.margin,this.margin),(this.state=="hover"||this.state=="down")&&(e.beginPath(),e.roundRect(this.x,this.y,t,i,4),e.strokeStyle=o.highlightColour,e.lineWidth=8,e.stroke()),e.beginPath(),e.roundRect(this.x,this.y,t,i,4),e.fillStyle=this.state=="down"?o.highlightColour:"lightgrey",e.strokeStyle="black",e.lineWidth=this.state=="down"?4:2,e.fill(),e.stroke(),e.clip(),e.font=o.font,e.fillStyle="black",e.textAlign="center",e.textBaseline="middle",e.fillText(this.text,this.x+t/2,this.y+i/2),e.restore(),super.draw(e)}toString(){return`SKButton '${this.text}'`}}class C extends D{constructor({text:e="",...t}={}){super(t),this.state="idle",this.focus=!1,this.font=o.font,this._text="",this.textWidth=0,this.padding=o.textPadding,this.text=e}get text(){return this._text}set text(e){this._text=e,this.setMinimalSize(this.width,this.height)}setMinimalSize(e,t){const i=P(this.text||" ",this.font);if(!i){console.warn(`measureText failed in SKTextfield for ${this.text}`);return}this.height=t||i.height+this.padding*2,this.width=e||i.width+this.padding*2,this.textWidth=i.width}applyEdit(e,t){return t=="Backspace"?e.slice(0,-1):t.length==1?e+t:e}handleKeyboardEvent(e){switch(e.type){case"focusout":return this.focus=!1,!0;case"focusin":return this.focus=!0,!0;case"keydown":return this.focus&&e.key&&(this.text=this.applyEdit(this.text,e.key)),this.sendEvent({source:this,timeStamp:e.timeStamp,type:"textchanged"})}return!1}handleMouseEvent(e){switch(e.type){case"mouseenter":return this.state="hover",!0;case"mouseexit":return this.state="idle",!0;case"click":return st(this),!0;case"mousedown":return!1;case"mouseup":return!1}return!1}draw(e){const t=this.paddingBox.width,i=this.paddingBox.height;if(e.save(),e.translate(this.x,this.y),e.translate(this.margin,this.margin),this.state=="hover"&&(e.beginPath(),e.rect(0,0,t,i),e.strokeStyle=o.highlightColour,e.lineWidth=8,e.stroke()),e.beginPath(),e.rect(0,0,t,i),e.fillStyle="white",e.fill(),e.lineWidth=1,e.strokeStyle=this.focus?"mediumblue":"black",e.stroke(),e.clip(),e.font=o.font,e.fillStyle="black",e.textBaseline="middle",e.textAlign="left",e.fillText(this.text,this.padding,i/2),this.focus){const h=this.padding+this.textWidth+1,a=i-o.textPadding;e.beginPath(),e.moveTo(h,o.textPadding/2),e.lineTo(h,a),e.lineWidth=1,e.strokeStyle="black",e.stroke()}e.restore(),super.draw(e)}toString(){return`SKTextfield '${this.text}'`}}class g extends D{constructor({text:e="?",align:t="centre",...i}={}){super(i),this.font=o.font,this._text="",this.padding=o.textPadding,this.text=e,this.align=t,this.fill="",this.border=""}get text(){return this._text}set text(e){this._text=e,this.setMinimalSize(this.width,this.height)}setMinimalSize(e,t){const i=P(this.text||" ",this.font);if(!i){console.warn(`measureText failed in SKLabel for ${this.text}`);return}this.height=t||i.height+this.padding*2,this.width=e||i.width+this.padding*2}draw(e){e.save();const t=this.paddingBox.width,i=this.paddingBox.height;switch(e.translate(this.x,this.y),e.translate(this.margin,this.margin),this.fill&&(e.fillStyle=this.fill,e.fillRect(0,0,t,i)),this.border&&(e.strokeStyle=this.border,e.lineWidth=1,e.strokeRect(0,0,t,i)),e.font=o.font,e.fillStyle="black",e.textBaseline="middle",this.align){case"left":e.textAlign="left",e.fillText(this.text,this.padding,i/2);break;case"centre":e.textAlign="center",e.fillText(this.text,t/2,i/2);break;case"right":e.textAlign="right",e.fillText(this.text,t-this.padding,i/2);break}e.restore(),super.draw(e)}toString(){return`SKLabel '${this.text}'`}}function lt(){return(s,e,t)=>rt(s,e,t)}function rt(s,e,t){const i={width:0,height:0};return t.forEach(h=>{(h.x<0||h.y<0||h.x+h.widthLayout>s||h.y+h.heightLayout>e)&&console.warn(`element ${h.toString()} outside parent bounds`),i.width=Math.max(i.width,h.x+h.widthLayout),i.height=Math.max(i.height,h.y+h.heightLayout)}),i}function ut(){return(s,e,t)=>ct(s,e,t)}function ct(s,e,t){const i={width:0,height:0};return t.forEach(h=>{h.fillWidth&&(h.widthLayout=s),h.fillHeight&&(h.heightLayout=e),h.x=s/2-h.widthLayout/2,h.y=e/2-h.heightLayout/2,i.width=Math.max(i.width,h.widthLayout),i.height=Math.max(i.height,h.heightLayout)}),i}function ft(s){return(e,t,i)=>pt(e,t,i,s)}function pt(s,e,t,{gap:i=0}={}){const h={width:0,height:0};let a=0,d=0,p=0;return t.forEach(l=>{l.widthLayout>s?console.warn(`element ${l.toString()} horizontal overflow`):a+l.widthLayout>s&&(a=0,d+=p+i,p=0),l.x=a,l.y=d,p=Math.max(p,l.heightLayout),a+=l.widthLayout+i,h.width=Math.max(h.width,l.widthLayout),h.height=Math.max(h.height,d+p)}),h.height>e&&console.warn("vertical overflow"),h}function mt(s){return(e,t,i)=>yt(e,t,i,s)}function yt(s,e,t,{gap:i=0}={}){const h={width:0,height:0},a=t.reduce((u,w)=>u+w.widthBasis,0),p=s-(t.length-1)*i-a,l=t.reduce((u,w)=>u+w.fillWidth,0);let y=0,B=0,S=0;t.forEach(u=>{u.x=y,u.y=B;let w=u.widthBasis;l>0&&(w+=u.fillWidth/l*p),u.widthLayout=w,u.fillHeight>0&&(u.heightLayout=e),S=Math.max(S,u.heightLayout),y+=w+i});const I=t.slice(-1)[0];return h.width=I.x+I.widthLayout,h.height=S,h}const r={makeFixedLayout:lt,makeCentredLayout:ut,makeWrapRowLayout:ft,makeFillRowLayout:mt};function wt(){let s=!0;return document.body.children.length!==1&&(console.error(`document body has ${document.body.children.length} children, expecting 1`),s=!1),document.body.querySelector("body>script")||(console.error("document body must have a script"),s=!1),document.head.querySelector("link, style")&&(console.error("document head must not have link or style tags"),s=!1),s}function xt(s="whitesmoke"){let e=document.createElement("canvas");return document.body.appendChild(e),e.style.setProperty("background",s),document.documentElement.style.setProperty("width","100%"),document.documentElement.style.setProperty("height","100%"),document.documentElement.style.setProperty("margin","0"),document.documentElement.style.setProperty("padding","0"),document.body.style.setProperty("width","100%"),document.body.style.setProperty("height","100%"),document.body.style.setProperty("margin","0"),document.body.style.setProperty("padding","0"),e.style.setProperty("width","100%"),e.style.setProperty("height","100%"),e.style.setProperty("display","block"),e.width=document.body.clientWidth,e.height=document.body.clientHeight,window.addEventListener("resize",()=>{e.width=document.body.clientWidth,e.height=document.body.clientHeight}),console.info(` created ${e.width} by ${e.height} canvas`),e}const gt="0.4.1";function St(s,e){let t=[],i=0;for(let h=0;h<s.length;h++)if(s[h].timeStamp<=e[i].timeStamp)t.push(s[h]);else{for(;i<e.length&&e[i].timeStamp<s[h].timeStamp;)t.push(e[i]),i++;t.push(s[h])}for(;i<e.length;)t.push(e[i]),i++;return t}function bt(s,e){it(s);let t=[];if(s.length==0){const i={type:"null",timeStamp:e};O.forEach(h=>{const a=h.update(i);a&&t.push(a)})}for(s.length==0&&s.push({type:"null",timeStamp:e});s.length>0;){const i=s.shift();i&&O.forEach(h=>{const a=h.update(i);a&&t.push(a)})}t=N.length>0?St(t,N):t,t.forEach(i=>{i.type=="resize"&&c&&L(),i instanceof F&&c&&at(i,c),i instanceof $&&ht(i),z&&z(i)}),c&&M&&(Lt(),M=!1),c&&(m.clearRect(0,0,m.canvas.width,m.canvas.height),c.draw(m))}let m;const O=[Z,Y,Q,tt];function vt(s){z=s}let z;const N=[];let c;function Et(s){c=s}let M=!1;function Lt(){c&&m&&(c.x=0,c.y=0,c.margin=0,c.doLayout(m.canvas.width,m.canvas.height),M=!1)}function L(){M=!0}function kt(){if(console.info(`ðŸ§° SimpleKit v${gt} *Imperative UI Mode* startup`),!wt())return!1;const e=xt().getContext("2d");return e?(m=e,et(bt),!0):(console.error("Unable to get graphics context from canvas"),!1)}class Bt{constructor(){n(this,"observers",[])}addObserver(e){this.observers.push(e),e.update()}removeObserver(e){this.observers=this.observers.filter(t=>t!==e)}notifyObservers(){this.observers.forEach(e=>e.update())}}class b extends f{constructor(t){super();n(this,"selected",!1);n(this,"ShapeId");n(this,"state","idle");this.state="idle",this.width=50,this.height=50,this.ShapeId=t,this.fill=this.getRandomHue()}getId(){return this.ShapeId}getState(){return this.state}getColour(){return this.fill}getSelected(){return this.selected}setSelected2(t){this.selected=t}setSelected(){this.selected=!this.selected}getRadius(){return""}getPoints(){return""}setHue(t){this.fill=t}setPoints(t){}setRadius(t){}getHue(){return this.fill}getRandomHue(){return`hsl(${Math.floor(Math.random()*360)}, 100%, 50%)`}parseHue(t){return parseInt(t.split(",")[0].split("(")[1])}draw(t){t.save(),t.beginPath(),this.state=="hover"&&(t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.strokeStyle=o.highlightColour,t.lineWidth=8,t.stroke()),t.rect(this.x,this.y,this.width,this.height),t.fillStyle=this.fill,t.fill(),t.strokeStyle="grey",t.lineWidth=2,t.stroke(),this.selected==!0&&(t.beginPath(),t.rect(this.x-2,this.y-2,this.width+4,this.height+4),t.strokeStyle=o.focusColour,t.lineWidth=2,t.fillStyle="white",t.stroke(),t.beginPath(),t.rect(this.x-1,this.y-1,this.width+2,this.height+2),t.strokeStyle="white",t.lineWidth=2,t.fillStyle="white",t.stroke()),t.clip(),t.restore(),super.draw(t)}handleMouseEvent(t){switch(t.type){case"mousedown":return this.state="down",!0;case"mouseup":return this.state="hover",console.log("shape action: actionX"),this.sendEvent({source:this,timeStamp:t.timeStamp,type:"action"});case"mouseenter":return this.state="hover",!0;case"mouseexit":return this.state="idle",!0;case"click":return this.state="hover",this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shapeclick"})}return!1}handleKeyboardEvent(t){const{key:i}=t;switch(console.log("KEYBOARD EVENT"),t.type){case"keydown":if(console.log("KEYDOWN"),i=="Shift")return console.log("SHIFT"),this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_down"});break;case"keyup":if(i=="Shift")return this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_up"});break}return!1}}class v extends dt{constructor({text:t="",...i}={}){super(i);n(this,"disabled",!1);n(this,"font",o.font);n(this,"state","idle");n(this,"_text","");this.padding=o.textPadding,this.text=t,this.calculateBasis(),this.doLayout()}get text(){return this._text}set text(t){this._text=t,this.setMinimalSize(this.width,this.height)}getDisabled(){return this.disabled}setDisabled(t){this.disabled=t}setMinimalSize(t,i){t=t||this.width,i=i||this.height;const h=P(this.text,this.font);if(!h){console.warn(`measureText failed in SKButton for ${this.text}`);return}this.height=i||h.height+this.padding*2,this.width=t||h.width+this.padding*2,t||(this.width=Math.max(this.width,80))}draw(t){t.save();const i=this.paddingBox.width,h=this.paddingBox.height;t.translate(this.margin,this.margin),this.disabled==!0?(t.beginPath(),t.roundRect(this.x,this.y,i,h,4),t.fillRect(this.x+2,this.y+2,i-4,h-4),t.fillStyle="lightgrey",this.state=="down"&&o.highlightColour,t.strokeStyle="b#ffffff7f",t.lineWidth=this.state=="down"?4:2,t.lineWidth=1,t.fill(),t.stroke(),t.clip()):((this.state=="hover"||this.state=="down")&&(t.beginPath(),t.roundRect(this.x,this.y,i,h,4),t.strokeStyle=o.highlightColour,t.lineWidth=8,t.stroke(),t.closePath()),t.beginPath(),t.roundRect(this.x,this.y,i,h,4),t.fillStyle=this.state=="down"?o.highlightColour:"lightgrey",t.strokeStyle="black",t.lineWidth=this.state=="down"?4:2,t.fill(),t.stroke(),t.clip()),t.font=o.font,t.fillStyle="black",this.disabled==!0&&(t.fillStyle="grey"),t.textAlign="center",t.textBaseline="middle",t.fillText(this.text,this.x+i/2,this.y+h/2),t.restore()}toString(){return`SKButton '${this.text}'`}}class k extends f{constructor(t){super();n(this,"selected",!1);n(this,"points");n(this,"ShapeId");n(this,"scale",1);n(this,"radius",25);n(this,"inEdit",!1);n(this,"state","idle");this.state="idle",this.width=50,this.height=50,this.ShapeId=t,this.points=this.randomNumber(3,10),this.fill=this.getRandomHue()}getId(){return this.ShapeId}getState(){return this.state}getColour(){return this.fill}getSelected(){return this.selected}setSelected2(t){this.selected=t}setSelected(){this.selected=!this.selected}setRadius(t){this.radius=t}setPoints(t){this.points=t}setScale(t){this.scale=t}getRadius(){return this.radius}getPoints(){return this.points}getHue(){return this.fill}setHue(t){this.fill=t}getRandomHue(){return`hsl(${Math.floor(Math.random()*360)}, 100%, 50%)`}randomNumber(t,i){return Math.floor(Math.random()*(i-t+1)+t)}parseHue(t){return parseInt(t.split(",")[0].split("(")[1])}draw(t){t.save(),t.scale(this.scale,this.scale),t.beginPath(),this.inEdit==!1&&(this.state=="hover"&&(t.beginPath(),t.rect(this.x,this.y,this.width,this.height),t.strokeStyle=o.highlightColour,t.lineWidth=8,t.stroke()),this.selected==!0&&(t.beginPath(),t.rect(this.x-2,this.y-2,this.width+4,this.height+4),t.strokeStyle=o.focusColour,t.lineWidth=3,t.fillStyle="white",t.stroke(),t.beginPath(),t.rect(this.x-1.5,this.y-1.5,this.width+3,this.height+3),t.strokeStyle="white",t.lineWidth=2.5,t.fillStyle="white",t.stroke()),t.rect(this.x,this.y,this.width,this.height),t.strokeStyle="black",t.lineWidth=.9,t.stroke()),t.translate(this.x,this.y),t.rotate(Math.PI);let i=-25,h=-25;this.radius,this.drawStar(t,i,h,this.radius,this.fill,this.points),t.restore()}drawStar(t,i,h,a,d,p){const l=p;t.fillStyle=d,t.beginPath(),t.moveTo(i,h+a);for(let y=0;y<2*l+1;y++){const B=y%2===0?a:a/2,S=Math.PI*y/l;t.lineTo(i+B*Math.sin(S),h+B*Math.cos(S))}t.closePath(),d&&t.fill(),t.strokeStyle="black",t.stroke()}handleMouseEvent(t){switch(t.type){case"mousedown":return this.state="down",!0;case"mouseup":return this.state="hover",this.sendEvent({source:this,timeStamp:t.timeStamp,type:"actionX"});case"mouseenter":return this.state="hover",!0;case"mouseexit":return this.state="idle",!0}return!1}handleKeyboardEvent(t){const{key:i}=t;switch(console.log("KEYBOARD EVENT"),t.type){case"keydown":if(console.log("KEYDOWN"),i=="Shift")return console.log("SHIFT"),this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_down"});break;case"keyup":if(i=="Shift")return this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_up"});break}return!1}}let H=1;class Tt extends Bt{constructor(){super();n(this,"shiftdown",!1);n(this,"selectedNum",0);n(this,"buttons",[]);n(this,"shapes",[]);n(this,"toBeEdited");n(this,"sizeX",0);n(this,"sizeY",0);n(this,"keyboardEvent",!1);n(this,"key","");n(this,"mouseX",0);n(this,"mouseY",0);this.buttons.push(new v({text:"Add"})),this.buttons.push(new v({text:"Add Star"})),this.buttons.push(new v({text:"Delete"})),this.buttons.push(new v({text:"Clear"}));for(let t=0;t<8;t++)this.shapes.push(new b(H++));this.handleDisableButton()}setShiftDown(){this.shiftdown=!0}setShiftUp(){this.shiftdown=!1}getButtons(){return this.buttons}allButtons(){return[...this.buttons]}allShapes(){return[...this.shapes]}handleSize(t,i){this.sizeX=t,this.sizeY=i,console.log("1-- ",t,i),this.notifyObservers()}handleButtonClick(t){t=="Add"&&this.shapes.length<20&&this.shapes.push(new b(H++)),t=="Add Star"&&(console.log("Add Star"),this.shapes.length<20&&this.shapes.push(new k(H++))),t=="Clear"&&(this.selectedNum=0,this.shapes=[]),t=="Delete"&&(this.shapes=this.shapes.filter(i=>!i.getSelected()),this.selectedNum-=this.selectedNum),this.handleDisableButton(),this.notifyObservers()}handleSelected(t){this.shiftdown==!0?this.handleShiftSelect(t):(this.selectedNum=0,this.shapes.forEach(i=>{i.getId()==t?(i.setSelected(),console.log("*no shift select*")):i.setSelected2(!1),i.getSelected()==!0&&this.selectedNum++})),this.selectedNum==0&&(console.log("no shape selected"),this.buttons[2].fill="blue"),this.handleDisableButton(),this.notifyObservers()}handleShiftSelect(t){this.selectedNum=0,this.shapes.forEach(i=>{i.getId()==t&&(i.setSelected(),console.log("Multiple shift selection")),i.getSelected()==!0&&this.selectedNum++}),this.handleDisableButton(),this.notifyObservers()}deselectAll(){this.selectedNum=0,this.shapes.forEach(t=>{t.setSelected2(!1)}),this.handleDisableButton(),this.notifyObservers()}textChanged(t){this.keyboardEvent=!0,this.key=t,this.notifyObservers()}updateStatus(){this.notifyObservers()}setNewHue(t){console.log("old hue",this.toBeEdited.getHue()),console.log("new hue",t),this.toBeEdited.getHue()!=t&&(console.log("hue changed"),this.toBeEdited.setHue(t),this.notifyObservers())}setNewRadius(t){console.log("old radius",this.toBeEdited.getRadius()),this.toBeEdited.setRadius(Number(t)),console.log("new radius",this.toBeEdited.getRadius()),this.notifyObservers()}setNewPoints(t){console.log("old points",this.toBeEdited.getPoints()),this.toBeEdited.setPoints(Number(t)),console.log("new points",this.toBeEdited.getPoints()),this.notifyObservers()}handleAdd(){this.handleDisableButton(),this.notifyObservers()}handleClicked(t,i){this.mouseX=t,this.mouseY=i;let h=!0;this.shapes.forEach(a=>{a.getSelected()==!0&&(h=!1)}),h&&(console.log("deselect all???"),this.shapes.forEach(a=>{a.setSelected2(!1)})),this.handleDisableButton(),this.notifyObservers()}handleDisableButton(){this.selectedNum==0?(console.log("no shape selected"),this.buttons[2].setDisabled(!0)):this.buttons[2].setDisabled(!1),this.shapes.length==20?this.buttons[0].setDisabled(!0):this.buttons[0].setDisabled(!1),this.shapes.length==20?this.buttons[1].setDisabled(!0):this.buttons[1].setDisabled(!1),this.shapes.length==0?this.buttons[3].setDisabled(!0):this.buttons[3].setDisabled(!1),this.selectedNum==1&&this.shapes.forEach(t=>{t.getSelected()==!0&&(this.toBeEdited=t)})}}class Ct extends v{constructor(e,t){super(),this.model=e,this.text=t.text,this.setDisabled(t.getDisabled()),this.handler=this.handler.bind(this),this.addEventListener("action",this.handler),this.model.addObserver(this)}update(){}handler(){this.model.handleButtonClick(this.text)}handler2(e){switch(e.type){}}}class Mt extends f{constructor(e){super(),this.model=e,this.layoutMethod=r.makeFillRowLayout({gap:10}),this.model.addObserver(this)}update(){this.clearChildren(),this.model.allButtons().forEach(e=>{this.addChild(new Ct(this.model,e))})}}class X extends b{constructor(e,t){super(t.getId()),this.model=e,this.fill=t.getColour(),this.setSelected2(t.getSelected()),this.addEventListener("action",()=>{this.model.handleSelected(this.getId())}),this.model.addObserver(this)}update(){this.getSelected()==!0}}class V extends k{constructor(e,t){super(t.getId()),this.model=e,this.fill=t.fill,this.points=t.points,this.radius=t.radius,this.setSelected2(t.getSelected()),this.addEventListener("actionX",()=>{this.model.handleSelected(this.getId())}),this.model.addObserver(this)}update(){this.getSelected()==!0}}class Rt extends f{constructor(e){super(),this.model=e,this.layoutMethod=r.makeWrapRowLayout({gap:20}),this.addEventListener("action",()=>{console.log("shape list view clicked");let t=!1;this.model.allShapes().forEach(i=>{i instanceof b?i.getState()==="down"&&(t=!0):i instanceof k&&i.getState()==="down"&&(t=!0)}),t||this.model.deselectAll()}),this.model.addObserver(this)}update(){this.clearChildren(),this.width=this.model.sizeX*2/3-40,this.height=this.model.sizeY-100,this.model.allShapes().forEach(e=>{if(e instanceof b){const t=new X(this.model,e);this.addChild(t)}else if(e instanceof k){const t=new V(this.model,e);t.height=50,t.width=50,t.radius=15,this.addChild(t)}})}}class Ft extends f{constructor(t){super();n(this,"statusText");n(this,"selectedText");this.model=t,this.statusText=new g,this.statusText.padding=10,this.selectedText=new g,this.selectedText.padding=10,this.addChild(this.statusText),this.addChild(this.selectedText),this.layoutMethod=r.makeFillRowLayout({gap:40}),this.model.addObserver(this),this.update()}update(){this.model.allShapes().length==20?this.statusText.text="                              20 shapes FULL":this.statusText.text=`                     ${this.model.allShapes().length} shapes`,this.model.shiftdown==!0?this.selectedText.text=`                                                                                                                                                                            SHIFTED ${this.model.selectedNum} selected`:this.selectedText.text=`                                                                                                                                                       ${this.model.selectedNum} selected`}}class Pt extends f{constructor(t){super();n(this,"w");n(this,"h");n(this,"hueLabel");n(this,"hueTextFieldSquare");this.model=t,this.w=this.model.sizeX,this.h=this.model.sizeY,this.layoutMethod=r.makeFixedLayout(),this.hueLabel=new g({text:"Hue"}),this.hueLabel.x=60,this.hueLabel.y=20,this.hueLabel.width=45,this.hueLabel.height=25,this.hueLabel.padding=0,this.hueTextFieldSquare=new C({text:"hue",x:120,y:20,width:45}),this.hueTextFieldSquare.height=25,this.hueTextFieldSquare.text=this.model.toBeEdited.getColour().toString(),this.addChild(this.hueLabel),this.addChild(this.hueTextFieldSquare),console.log("square hue label",this.hueLabel.x,this.hueLabel.y,this.hueLabel.width,this.hueLabel.height),this.hueTextFieldSquare.addEventListener("textchanged",i=>{const h=i.source;console.log(`textfield textchanged '${h.text}'`);const a=parseInt(h.text)||0;console.log("***** output of text hue ******",a),a>=0&&a<=360&&this.model.setNewHue(`hsl(${a}, 100%, 50%)`)}),this.model.addObserver(this)}update(){this.clearChildren(),this.w=this.model.sizeX,this.h=this.model.sizeY,this.hueTextFieldSquare.text=this.model.toBeEdited.parseHue(this.model.toBeEdited.getColour()).toString(),this.addChild(this.hueLabel),this.addChild(this.hueTextFieldSquare),console.log("focus..",this.hueTextFieldSquare.focus)}}class Dt extends f{constructor(t){super();n(this,"w");n(this,"h");n(this,"hueLabel",new g({text:"Hue"}));n(this,"hueTextField",new C({text:"",x:100,y:20,width:45,height:25}));n(this,"radiusLabel",new g({text:"Radius"}));n(this,"radiusTextField",new C({text:"",x:110,y:60,width:45,height:25}));n(this,"pointsLabel",new g({text:"Points"}));n(this,"pointsTextField",new C({text:"",x:110,y:100,width:45,height:25}));this.model=t,this.w=this.model.sizeX,this.h=this.model.sizeY,this.layoutMethod=r.makeFixedLayout(),this.padding=20,this.hueTextField.height=25,this.hueLabel.y=20,this.addChild(this.hueLabel),this.addChild(this.hueTextField),this.radiusTextField.height=25,this.radiusLabel.y=60,this.addChild(this.radiusLabel),this.addChild(this.radiusTextField),this.pointsTextField.height=25,this.pointsLabel.y=100,this.addChild(this.pointsLabel),this.addChild(this.pointsTextField),this.hueTextField.addEventListener("textchanged",i=>{const h=i.source;console.log(`textfield textchanged '${h.text}'`),h.text=h.text.replace(/[^0-9]/g,"");const a=parseInt(h.text)||0;console.log("***** output of text hue ******",a),a>=0&&a<=360&&this.model.setNewHue(`hsl(${a}, 100%, 50%)`)}),this.radiusTextField.addEventListener("textchanged",i=>{const h=i.source;console.log(`textfield textchanged '${h.text}'`),h.text=h.text.replace(/[^0-9]/g,"");const a=parseInt(h.text)||0;console.log("***** output of text RADIUS ******",a),a>=20&&a<=45&&this.model.setNewRadius(h.text)}),this.pointsTextField.addEventListener("textchanged",i=>{const h=i.source;console.log(`textfield textchanged '${h.text}'`),h.text=h.text.replace(/[^0-9]/g,"");const a=parseInt(h.text)||0;console.log("***** output of text Points ******",a),a>=3&&a<=9&&this.model.setNewPoints(h.text)}),this.model.addObserver(this)}update(){this.clearChildren(),this.w=this.model.sizeX,this.h=this.model.sizeY;let t=(this.w/6-80)/2;this.hueLabel.x=t,this.hueTextField.x=t+60,this.hueTextField.text=this.model.toBeEdited.parseHue(this.model.toBeEdited.getColour()).toString(),this.addChild(this.hueLabel),this.addChild(this.hueTextField),this.radiusLabel.x=t,this.radiusLabel.y=60,this.radiusTextField.x=t+60,this.radiusTextField.text=this.model.toBeEdited.getRadius().toString(),this.addChild(this.radiusLabel),this.addChild(this.radiusTextField),this.pointsLabel.x=t,this.pointsLabel.y=100,this.pointsTextField.x=t+60,this.pointsTextField.text=this.model.toBeEdited.getPoints().toString(),this.addChild(this.pointsLabel),this.addChild(this.pointsTextField)}getHue(){return`hsl(${this.hueTextField.text}, 100%, 50%)`}getRadius(){return this.radiusTextField.text}getPoints(){return this.pointsTextField.text}}class Wt extends f{constructor(t){super();n(this,"w");n(this,"h");this.model=t,this.w=this.model.sizeX,this.h=this.model.sizeY,this.width=this.w*1/3,this.height=this.h,this.layoutMethod=r.makeFixedLayout(),this.model.addObserver(this)}update(){if(this.clearChildren(),this.w=this.model.sizeX,this.h=this.model.sizeY,this.layoutMethod=r.makeFixedLayout(),this.model.selectedNum==1){if(this.model.toBeEdited instanceof b){const t=new X(this.model,this.model.toBeEdited);t.x=40,t.y=40,t.border="black",t.width=this.w*1/3-120,t.height=this.h*2/3-150,console.log("square***",t.x,t.y,t.width,t.height,t.fillHeight,t.fillWidth,t.fill),t.setSelected2(!1),this.addChild(t);const i=new Pt(this.model);i.padding=0,i.x=0,i.y=this.h*2/3-40,i.border="grey",i.width=this.width-40,i.height=this.h*1/3-50,i.id="form",console.log("form",i.x,i.y,i.width,i.height),this.addChild(i)}else if(this.model.toBeEdited instanceof k){const t=new V(this.model,this.model.toBeEdited);t.x=40,t.y=40;let h=(this.w<this.h?this.w/3-10:this.h*2/3)/80*2/3/1.6;t.setScale(h),console.log("radius here",t.radius),console.log("points here",t.points),t.inEdit=!0,t.setSelected2(!1),this.addChild(t);const a=new Dt(this.model);a.padding=0,a.border="grey",a.x=0,a.y=this.h*2/3-50,a.width=this.width-40,a.height=this.h*1/3-40,a.id="form",console.log("star fill",t.fill),this.addChild(a)}}else{this.layoutMethod=r.makeCentredLayout();const t=new g;this.addChild(t),t.text=this.model.selectedNum<1?"Select one":"Too many selected"}}}function _(s,e){const t=new f;return t.id=s,t.fill=e,t}class Ht extends f{constructor(t){super();n(this,"leftSide");n(this,"rightSide");n(this,"toolbar");n(this,"list");n(this,"statusbar");n(this,"canvasHeight");n(this,"canvasWidth");this.model=t,this.id="root",this.fill="whitesmoke",this.canvasHeight=500,this.canvasWidth=800,this.width=this.canvasWidth,this.height=this.canvasHeight,this.drawLayout(),this.handleEvent=this.handleEvent.bind(this),vt(this.handleEvent),this.model.addObserver(this)}update(){this.clearChildren(),this.drawLayout(),this.handleResize()}drawLayout(){this.leftSide=_("left","white"),this.leftSide.x=0,this.leftSide.y=0,this.addChild(this.leftSide),this.leftSide.layoutMethod=r.makeFixedLayout(),this.toolbar=_("toolbar","lightgrey"),this.toolbar.height=50,this.toolbar.x=0,this.toolbar.y=0,this.toolbar.width=this.canvasWidth*2/3,this.toolbar.padding=10,this.leftSide.addChild(this.toolbar),this.toolbar.addChild(new Mt(this.model)),this.toolbar.layoutMethod=r.makeFixedLayout(),this.list=_("list","white"),this.list.x=0,this.list.y=50,this.list.width=500,this.list.height=500,this.leftSide.addChild(this.list),this.list.padding=20,this.list.addChild(new Rt(this.model)),this.list.layoutMethod=r.makeFillRowLayout({gap:20}),this.statusbar=new f,this.statusbar.fill="lightgrey",this.statusbar.id="statusbar",this.statusbar.height=50,this.statusbar.width=400,this.statusbar.x=0,this.statusbar.y=this.canvasHeight-50,this.statusbar.padding=10,this.leftSide.addChild(this.statusbar),this.statusbar.addChild(new Ft(this.model)),this.statusbar.layoutMethod=r.makeFillRowLayout({gap:100}),this.rightSide=new f,this.rightSide.fill="whitesmoke",this.rightSide.id="right",this.rightSide.margin=10,this.rightSide.border="black",this.rightSide.x=this.canvasWidth*2/3,this.rightSide.y=0,this.addChild(this.rightSide),this.rightSide.layoutMethod=r.makeFillRowLayout();const t=new Wt(this.model);t.padding=10,t.fillHeight=1,t.fillWidth=1,this.rightSide.addChild(t)}handleResize(){this.canvasWidth=this.model.sizeX,this.canvasHeight=this.model.sizeY,this.width=this.canvasWidth,this.height=this.canvasHeight,this.leftSide.width=this.canvasWidth*2/3,this.leftSide.height=this.canvasHeight,this.rightSide.width=this.canvasWidth*1/3,this.rightSide.height=this.canvasHeight-20,this.rightSide.width=this.canvasWidth*1/3-20,this.toolbar.width=this.canvasWidth*2/3,this.statusbar.width=this.canvasWidth*2/3,this.statusbar.y=this.canvasHeight-50,this.list.width=this.canvasWidth*2/3,this.list.height=this.canvasHeight-100}handleEvent(t){const{key:i}=t;switch(console.log("---- hi root event ----"),t.type){case"gestureend":break;case"resize":console.log("Resize event received:",t.type);const{width:h,height:a}=t;console.log("resize...",h,a),h!=null&&a!=null&&(this.canvasWidth=h,this.canvasHeight=a,console.log(this.canvasHeight),this.model.handleSize(this.canvasWidth,this.canvasHeight));break;case"keydown":if(console.log("KEYDOWN"),i=="Shift")return console.log("SHIFT"),this.model.setShiftDown(),this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_down"});break;case"keyup":if(i&&console.log("main key entered: ",i),i=="Shift")return this.model.setShiftUp(),this.sendEvent({source:this,timeStamp:t.timeStamp,type:"shift_up"});break;case"click":console.log("click in main");break}return!1}handleClicked(t,i){console.log("handle clicked main","x:",t,"y:",i),console.log("main: clicked inside listview"),this.model.handleClicked(t,i)}}const _t=new Tt,zt=new Ht(_t);Et(zt);kt();
